// Copyright (c) 2013 Rice University
// This software is subject to the provisions of the GNU AFFERO GENERAL PUBLIC LICENSE Version 3.0 (AGPL).
// See LICENSE.txt for details.
// Copyright (c) 2013 Rice University
// This software is subject to the provisions of the GNU AFFERO GENERAL PUBLIC LICENSE Version 3.0 (AGPL).
// See LICENSE.txt for details.



// Usually Skeleton files would not contain styling information
// but rather would only tie slots to the dom. In the case of the
// base file there are many adhoc pieces of style that are defined here
// (sometimes for lack of a better home). Usually these apply to all
// elements of a given type, eg, all h1-h6, all ol/ul, etc.


@namespace mml "http://www.w3.org/1998/Math/MathML";


/* hides the table caption in caption to place at bottom of table */
div.table-caption.caption {
  display: none;
  string-set: caption-bottom content();
}



/***************************************************
 * Book Table of Contents
 ***************************************************/

.book > .toc {
  #part>#toc>.style();

  > .title {
    #part>#toc>#title>.style();
  }



  a {
    #part>#toc>#entry>.title(default);

    // Chapter 3 : Type Systems ........................ 213
    &::after { #part>#toc>#entry>.page(); }
  }


  > li > ul a { #part>#toc>#entry>.title(top); }

  // Hide TOC entries for sections in a  Preface or Appendix
  .toc-preface .toc-section  { #part>#toc>.show-sections-in(preface); }
  .toc-appendix .toc-section { #part>#toc>.show-sections-in(appendix); }

  .toc-chapter {
    > .target-chapter::before { display: none; } //remove number before chapter
    .cnx-gentext-chapter {
      display: inline;  // display as an inline-level element
      &.cnx-gentext-t {

      }
    }
    // did not use the class selector .cnx-gentext-autogenerated bc two spans in the .target-chapter have the same class name
    span:nth-of-type(3) { prince-text-replace: "." ":"; }  // Chapter 1: The Study of Life
  }

  // TOC Section
  .toc-section {

    > a {
      #part>#toc>#entry>.title(section);
    }
    .cnx-gentext-section {

    .cnx-gentext-autogenerated { display: none; } // removes '.' after section number
  }
}


// Hide sub-sections from the book, chapter, section level TOCs
.toc .toc-section .toc-section { #part>#toc>.show-sections-in(section); }

/***************************************************
 * PREFACE
 ***************************************************/

.preface {
  > .titlepage {
    h1.title { #part>#preface>#titlepage>.title(); }
  }

  > .section  {
  }

  //preface: table without separators: hide table caption and table border
  .table {
    caption { display: none; }
    table { border-bottom: none !important; }  //override book specific rule
  }

  .figure > .title { display: none; } //preface: hide figure title

  ul > li { list-style-type: none; }
}


/***************************************************
 * CHAPTER INTRODUCTION
 ***************************************************/
 // titlepage: introduction banner - used for page headers
h1.title { //ccap-chapter
  #part>#title>.style(default);

  .cnx-gentext-autogenerated { display: none; } //The 1st span contains the chapter number

  .cnx-gentext-n { //ccap-chapter-number
    #part>#title>.number(default);
  }
}

.chapter  > .introduction {

  // hide manual key concepts table
  table.simplelist { display: none; }

  > .title { //.ccap-intro-title
    #part>#introduction>#title>.style(chapter);
  }

  .splash {
    img {
      #part>#introduction>#splash-figure>.image(chapter);
    }
  }

  > .toc {
    #part>#introduction>#chapter-outline>.style();

    > .title {
      #part>#introduction>#chapter-outline>#title>.style();
      #part>#introduction>#chapter-outline>#title>.content();
    }

    > * {
      #part>#introduction>#chapter-outline>.children();
      > li {
        #part>#introduction>#chapter-outline>#entry>.style();
      }
    }

    // TODO: Delete me. this is the same as #part>#toc>.children()
    > ul {

    a {
      #part>#introduction>#chapter-outline>#entry>#title>.style();
    }
    .toc-section {
      .abstract { display: none; } //hide section-level abstract from objectives
      .cnx-gentext-autogenerated { display: none; }
      .cnx-gentext-t { #part>#introduction>#chapter-outline>#entry>.children-indent(); }
      .cnx-gentext-n {
        &::after { #part>#introduction>#chapter-outline>#entry>.d-section-colon(); } //add : after section #
        }
    }
    .abstract {
      #part>#introduction>#chapter-outline>#entry>#abstract>.style();
      ul {
        #part>#introduction>#chapter-outline>#entry>#abstract>.list();
        > li { #part>#introduction>#chapter-outline>#entry>#abstract>.list-item(); }
      }

    }
  }
}

/***************************************************
 * SECTION LEVEL LEARNING OBJECTIVES (section abstract)
 ***************************************************/
div.section > div.titlepage {
  div.abstract {
    #part>#chapter>#learning-objectives>.style();
    ul.itemizedlist {
      #part>#chapter>#learning-objectives>.list();
      > li { #part>#chapter>#learning-objectives>.list-item(); }
    }
  }
}

/* Squirrel away the collection URL so it shows up as the footer on every page */
#title_page_url a[href] {
  prince-text-replace: ":9680" "";  //this strips the port number
  string-set: cnx-collection-url attr(href);
}

/* Don't print module asterix (link to attribution) */
.section .titlepage, .introduction > .title, .appendix .titlepage {
  sup a { display: none; }
}

/* Hide the TOC for the Appendix */
.appendix .toc { display: none; }


/* Footnotes. remove margins */
.footnote {
  #content>#footnote>.style();
}

/********************** Generic Elements ********************/
body {
  font-size: 8.2pt;
  font-family: @font-family;
}

// BUGFIX: In princexml SVG in a table heading doesn't use the fonts set in the SVG
/* This NEEDS to be on its own line (can't do "body, th * { ...") */
th * { font-family: @font-family; }

a[href^="http"] { content: content() " (" attr(href) ") "; }

.chapter, .appendix, .colophon {
  #utils>#pb>.before(right);
  #utils>#pb>.after(left);
}

.equation {
  #content>#equation>.style();
}
.equation .label { #content>#equation>.label(); }

.figure { #content>#figure>.style(); }

.mathml-mi { font-family: Liberation Serif, serif, STIXGeneral, STIXSizeOneSym, STIXSize1; }

/**************************** Index **************************/
.book > .index {
  #index>.style();

  .index-term {
   #index>.term();
  }
}

.index .title * {
  #index>#title>.style();
}

.index .letter {
 #index>.letter();
}


.indexdiv, .indexdiv dl { #utils>#pb>.inside(auto); }

.indexterm[href] { content: target-counter(attr(href), page); }


/********************* Glossary Section **************/
#book.attribution, .colophon { font-size: x-small; }


/**************** Fix the PDF Outline *************/
h1 { bookmark-level: 1; #utils>#pb>.after(avoid); }
h2 { bookmark-level: 2; #utils>#pb>.after(avoid); }
h3, h4, h5, h6 { bookmark-level: none; #utils>#pb>.after(avoid); }


/***************************************************************
 * Clean up padding and spacing
 ***************************************************************/
li p, dd p {
  margin-top: 0px;
  margin-bottom: 0px;
}

ol, ul { margin-top: 0px; }

dl { margin: 0.5em; }

// TODO: This needs to be removed as it produces three levels of settings
// for paragraph leading. Our indentation mixin, the default prince style and this
// Need to reduce to just one override, our mixin overridding prince default style
p { margin: 0.5em 0em; }

.table { #content>#table>.style(); }

.table td { #content>#table>.cell(); }

.table caption { #content>#table>.caption(); }


//Reset the table caption because I was dumb and didn't wrap the Table title in a span




.table th {
  #content>#table>.header();

  /* To fully support row/col spans in CALS tables borders are calculated for each cell and inherit the color of the text in the cell */
  /* By default the color in the PDF is the same color as the text so set it to black. */
  border-color: black !important;
}




/***************************************************************
 * Styles originally from physics but used in Sociology
 ***************************************************************/

/***************** Title page *****************/

.book > .cnx-title h1 {

}

.cnx-title a, #book-attribution a { content: content(); }

a { text-decoration: none; }

.problems-exercises img {

}

/***************************************************************
 * Clean up padding and spacing
 ***************************************************************/


/**************** CNXML ELements ***********/
.note { //.ccap-note
  #content>#note>.style();
}

.note h3 { #content>#note>#title>.style(); }

span.underline { text-decoration: underline; }

.note > .title { #content>#note>.header(); }

.exercise { #content>#exercise>.style(); }

.example { #content>#example>.style(); }

.figure > .caption:before,
.figure > .title {

}

.figure > .caption { display: inline; }

.figure > .body { text-align: center; }

/************** Generic Elements ************/
/* center the table */
table.cnx-figure-horizontal { margin: auto; }

table.cnx-figure-horizontal td img { max-width: 2in; }

table.cnx-figure-horizontal td img[height] { height: auto; }

img[height] { width: auto; }

img { max-width: 7in; }

ul.itemizedlist.no-mark { #content>#list>.style('no-mark'; any); }


/********************* Glossary Section **************/
// This is here for older books
.glossary {
  #part>#glossary>.style(chapter);
  .titlepage h2 { #part>#glossary>#title>.style(chapter); }
  dl {
    #part>#glossary>.style(chapter);
    dt {
      #part>#glossary>.term(chapter);
      &::after {
        #part>#glossary>.divider(chapter);
      }
    }
    dd { #part>#glossary>.definition(chapter); }
  }
}

em.glossterm {

}

.glossterm.no-emphasis {

}

/******************************************************
 * End of chapter customizations
 ******************************************************/
.cnx-eoc {
  & > .title { #part>#chapter-end>#title>.style();  }
  .section {
    .title {
      #part>#chapter-end>#section>#title>.style();

      a {

      }
    }

    .problem {
      #utils>#pb>.inside(avoid);
    }
  }
}


// EOC Exercise fixes have not been refactored. These seem to be adhoc fixes due to Docbook.
// If these are going to be removed in the future then it's likely best to just keep
// them here.

/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * End-of-chapter exercises require a LOT of custom formatting
 * Moving from Docbook will fix this
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

/* Exercises have the number in bold, followed by the 1st paragraph inline, not "Exercise 3 \n sldkfj" */

.cnx-eoc .exercise {

  /*** Exercises normally have more margins around them ***/
  margin-top: 0.5em;
  margin-bottom: 0.0em;

  div, p:first-of-type {
    display: initial;
  }

  div .figure {
    .body {
      display: block;
      text-align: center;
    }
    .title {
      //display: none;
    }
  }

  /* Hide the "Exercise " prefix */
  & > .title .cnx-gentext-autogenerated {
    display: none;
  }
  & > .title .cnx-gentext-n {

  }
  & > .title {
    border-bottom: 0px;
  }

  /*** Make sure the default background colors for things like exercise body don't seep through ***/
  p, .body {

  }


  .solution {
    display: none;
  }

  .problem > .title {

  }

}

.exercise .solution::before {

}

/***************************************************
 * Indentation
 ***************************************************/
.cnx-indentation-base;

@page {
  #page>.style();

  // Less complains about @footnotes{...} so use value escaping to inject it into the CSS
  @footnotes: ~"@footnotes";
  @{footnotes} {
    #page>.footnotes();
  }

}

// LessCSS does not support `@page { &:left {...}}` as a nested selector
@page:left {
  @top-left-corner { #page>.top-left-corner(left); }
  @top-right-corner { #page>.top-right-corner(left); }
  @bottom-left-corner { #page>.bottom-left-corner(left); }
  @bottom-right-corner { #page>.bottom-right-corner(left); }
  @top-left { #page>.top-left(left); }
  @top-center { #page>.top-center(left); }
  @top-right { #page>.top-right(left); }
  @bottom-left { #page>.bottom-left(left); }
  @bottom-center { #page>.bottom-center(left); }
  @bottom-right { #page>.bottom-right(left); }
  @left-top { #page>.left-top(left); }
  @left-middle { #page>.left-middle(left); }
  @left-bottom { #page>.left-bottom(left); }
  @right-top { #page>.right-top(left); }
  @right-middle { #page>.right-middle(left); }
  @right-bottom { #page>.right-bottom(left); }
}

@page :right {
  @top-left-corner { #page>.top-left-corner(right); }
  @top-right-corner { #page>.top-right-corner(right); }
  @bottom-left-corner { #page>.bottom-left-corner(right); }
  @bottom-right-corner { #page>.bottom-right-corner(right); }
  @top-left { #page>.top-left(right); }
  @top-center { #page>.top-center(right); }
  @top-right { #page>.top-right(right); }
  @bottom-left { #page>.bottom-left(right); }
  @bottom-center { #page>.bottom-center(right); }
  @bottom-right { #page>.bottom-right(right); }
  @left-top { #page>.left-top(right); }
  @left-middle { #page>.left-middle(right); }
  @left-bottom { #page>.left-bottom(right); }
  @right-top { #page>.right-top(right); }
  @right-middle { #page>.right-middle(right); }
  @right-bottom { #page>.right-bottom(right); }
}

@page introduction {
  #page>.style('introduction');
}
// Copyright (c) 2013 Rice University
// This software is subject to the provisions of the GNU AFFERO GENERAL PUBLIC LICENSE Version 3.0 (AGPL).
// See LICENSE.txt for details.
h2, h3, h4 {
  margin: initial;
  sup {
    display:none;
  }
}
@kind: default;
@part: chapter;
@context: default;



.title {
}

.note {


  &.qa {
    @context: feature-qa;
    #content>#note>.style(qa);

    > .title {
      #content>#note>#title>.style(@kind; @part; @context);
    }
    // the paragraph inside body has to be specifically targeted here to remove top-margin. grr.
    >.body, .body > p {
      #content>#note>#body>.style(@kind; @part; @context);
    }

    > .body .figure .title { #content>#figure>#title>.style(any; any; @context); }
  }

  &.try {
    @context: feature-try;
   //  #content>#note>.style(try);
   //  div.itemizedlist, div.orderedlist {
   //    ul, ol {
   //      #content>#list>.style(any; try);
   //    }
   // }
    > .title {
      #content>#note>#title>.style(@kind; @part; @context);
    }

    .exercise {
      #content>#exercise>.style(@kind; @part; @context);
      > .title { #content>#exercise>#title>.style(@kind; @part; @context); }

      .problem {
        #content>#problem>.style(@kind; @part; @context; exercise);
      }
      .solution {
        #content>#solution>.style(@kind; @part; @context; exercise);
      }
    }
  }
  &:not(.@{book-title}) {
    #content>#note>.style(non-feature);
    > .title { #content>#note>#title>.style(non-feature); }
  }
}

/* -------------------------
 * Preface
 * -------------------------
 */
div.book div.preface {
  > .titlepage {
    #part>#preface>#titlepage>.style();
    h1.title { #part>#preface>#titlepage>.title(); }
  }

  > div.section {
    div.titlepage > div > div > h2 {
      #content>#section>#title>.style(any; preface);
    }

    > div.section {
      > div.titlepage > div > div > h3 {
        #content>#section>#title>.style(any; preface; section);
      }
    }
  }
}

.chapter > .introduction > .figure.splash {
  #content>#figure>.style('splash'; chapter);
}
/* -------------------------
 * Book Table of Contents
 * -------------------------
 */
.book > .toc {
  #part>#toc>.style();

  > .title {
    #part>#toc>#title>.style();
  }

  a {
    #part>#toc>#link>.style();
  }
}

/* -------------------------
 * Unit Page
 * -------------------------
 */
div.part > div.titlepage { display: none; }


/* -------------------------
 * Put the chapter title and introduction section on the
 * introduction page, which has reduced margin.
 * -------------------------
 */
.chapter > .titlepage,
.chapter > .introduction {
  page: introduction;
}

/* -------------------------
 * Chapter Introduction
 * -------------------------
 */
.chapter > .introduction {
  >.title {
    #part>#introduction>#title>.style();
  }

  > .toc a {
    #part>#introduction>#chapter-outline>#entry>#title>.style();
  }

  // overide hyperlink medium blue color must be back and normal weight
  > .toc .toc-section .cnx-gentext-t {

  }

  // Take away default colon display after number
  > .toc .toc-section .cnx-gentext-n:after {
    content: "";
  }


  /******************************************************************
   * Styling for Chapter Outline Box
   ******************************************************************/
  >.toc {
    #part>#introduction>#chapter-outline>.style();

    >.title {
      #part>#introduction>#chapter-outline>#title>.style();
    }
  }
}

/********************************************************************
 * Styling for Chapter Titles
 ********************************************************************/

div.book div.chapter > div.titlepage > div > div h1.title {
  #part>#chapter>#title>.style();
  span.cnx-gentext-n {
    #part>#chapter>#title>.number();
  }
  span.cnx-gentext-t {
    #part>#chapter>#title>.text();
    &::before {
      #part>#chapter>#title>.divider();
    }
  }
  span.cnx-gentext-autogenerated {
    #part>#chapter>#title>.label();
  }
}

/********************************************************************
 * Styling for Appendix
 ********************************************************************/
div.book > div.appendix > div.titlepage > div > div h1.title {
  #part>#book-end>#appendix>#title>.style();

  span.cnx-gentext-autogenerated:first-of-type {
    #part>#book-end>#appendix>#title>.label();
  }

  span.cnx-gentext-n {
    #part>#book-end>#appendix>#title>.number();
  }
  span.cnx-gentext-t {
    #part>#book-end>#appendix>#title>.text();
    &::before {
      #part>#book-end>#appendix>#title>.divider();
    }
  }
}

div.book > div.appendix > div.section {
  #content>#section>.style(any; appendix);
}
//appendix  section title
div.book > div.appendix > div.section > div.titlepage h2 {
  #content>#section>#title>.style(any; appendix);
  &::before {
    #content>#section>#title>.number(any; appendix);
  }
  span.cnx-gentext-t {
    #content>#section>#title>.text(any; appendix);
  }
  span.cnx-gentext-autogenerated:first-of-type {
    #content>#section>#title>.label(any; appendix);
  }
}

//appendix sub section title
div.book > div.appendix > div.section  > div.section > div.titlepage h3 {
  #content>#section>#title>.style(any; appendix; section);
  &::before {
    #content>#section>#title>.number(any; appendix; section);
  }
  span.cnx-gentext-t {
    #content>#section>#title>.text(any; appendix; section);
  }
  span.cnx-gentext-autogenerated:first-of-type {
    #content>#section>#title>.label(any; appendix; section);
  }
}

/********************************************************************
 * Styling for Module Titles
 ********************************************************************/
div.book div.chapter > div.section > div.titlepage h2 {
  #part>#module>#title>.style();

  &::before {
    #part>#module>#title>.number();
  }
  span.cnx-gentext-n { #part>#module>#title>.number(); }

  span.cnx-gentext-t {
    #part>#module>#title>.text();
    &::before { #part>#module>#title>.divider(); }
  }
}

/********************************************************************
 * Styling for Module Section/Subsection Titles
 ********************************************************************/
div.book div > div.section > div.section {
  #content>#section>.style(any; any);
  div.titlepage > div > div > h3 { #content>#section>#title>.style(any; any); }

  > div.section { // Sub-sections
    #content>#section>.style(any; any; section);
    div.titlepage > div > div > h4 { #content>#section>#title>.style(any; any; section); }
  }
}

/********************************************************************
 * Styling for Learning Objectives Box
 ********************************************************************/

.section > .titlepage {
  .abstract {
    &::before {
     #part>#chapter>#learning-objectives>#title>.style();
    }
    .itemizedlist > ul {
      #part>#chapter>#learning-objectives>#list>.style();
     }



    .itemizedlist > .listitem > p {

    }


    // Special three-part numbering for Learning Objective chapter.section.learning-objectives
    .itemizedlist > .listitem {


      &::before {

      }
    }
  }
}

/********************************************************************
 * End of chapter customizations
 ********************************************************************/

// eoc solution number links color
.cnx-eoc > .solution > a.number { }

.cnx-eoc {
  #part>#chapter-end>.style();

  > .title {
    #part>#chapter-end>#title>.style();
  }

  &.summary {
    #part>#chapter-end>#summary>.style();
    > .title { #part>#chapter-end>#summary>#title>.style(); }
    > .section .title > a { #part>#chapter-end>#summary>#title>.link(); }
    p:nth-of-type(1) {  }
  }

  &.key-equations {
    #part>#chapter-end>#key-equations>.style();
    > div.title { #part>#chapter-end>#key-equations>#title>.style(); }
    > div.section > div.body {
      div.table { counter-increment: none; }
      table { #content>#table>.style(any; chapter; chapter-end; key-equations); }
    }
  }

  &.key-concepts {
    #part>#chapter-end>#key-concepts>.style();
    > div.title { #part>#chapter-end>#key-concepts>#title>.style(); }
    // There doesn't seem to be a way to handle subsection titles in namespace yet.
    // Targeting the link tag 'a' with layout change (margin, padding) doesn't work
    // and isn't a good practice.  It's a bit like putting margin and padding on h1, h2, etc.
    // Better to just let the container do the layout instead of the element.
    > .section > .title { #part>#chapter-end>#key-concepts>#title>.subtitle(); }

    > .section > .title > a { #part>#chapter-end>#key-concepts>#title>.link(); }
  }

  &.review-exercises {
    #part>#chapter-end>#review-exercises>.style();
    > .title {
      #part>#chapter-end>#review-exercises>#title>.style();
    }
  }

  &.practice-test {
    #part>#chapter-end>#practice-test>.style();
    > .title {
      #part>#chapter-end>#practice-test>#title>.style();
    }
  }

  &.cnx-solutions {
    #content>#solution>.style(@kind; chapter);
    > .section .title > a { #content>#solution>#title>.link(); }
    p:nth-of-type(1) {  }
  }

  .problem ol {
    #content>#list>.style(any; any; problem; exercise);
  }
  .problem::before {
    #content>#problem>.number(@kind; chapter-end);
  }

  .empty { display: hidden; } // hide, but count, empty elements.

  .exercise div.body div.problem .figure { #content>#figure>.style(any; chapter-end; exercise); }
}

// Turn off section numbering and title for eoc collations
.review-exercises, .practice-test, .key-equations, .summary {
  > .section > .title { display: none; }
}





/* ---------------------------------------------------
 * End of Book Solutions
 * ---------------------------------------------------
 */
div.colophon.end-of-book-solutions {
  prince-text-replace: "Answer:" ""; //strip out "Answer:" eob solutions for print_pdf
  #part>#book-end>#end-of-book-solutions>.style();

  > .title {
    #part>#book-end>#end-of-book-solutions>#title>.style();
  }

  // Some miscellaneous stuff we will have to decide on
  div.chapter-area:first-of-type h2.title {

  }

  .chapter-area {

    a.solution {

    }

    > h2.title a.chapter,
    > h2.title a.chapter span {
      #part>#book-end>#end-of-book-solutions>#title>.style('chapter-area');
    }
    > h2.title a.chapter {
      // Now that this is display: block it honors page break
      // rules from .chapter {}. Reset it.
      #utils>#pb>.before(avoid);
      #utils>#pb>.after(avoid);
    }
    > h2.title a.chapter span { display: inline; } // reset display: block for spans

    > div.review-exercises::before {
      #part>#book-end>#end-of-book-solutions>#title>.style('review-exercises');
    }
    > div.practice-test::before {
      #part>#book-end>#end-of-book-solutions>#title>.style('practice-test');
    }
    > div.try {
      &::before { #part>#book-end>#end-of-book-solutions>#title>.style('try-it'); }
      div.solution > div.title a.solution::before {
        content: target-counter(attr(href), chapter) "." target-counter(attr(href), try);
      }
    }
    > div.section-exercises::before {
      #part>#book-end>#end-of-book-solutions>#title>.style('section-exercises');
    }


    div.solution {
      #content>#solution>.style(@kind; book-end);

      > div.title {
        #content>#solution>#title>.style(@kind; book-end);
      }

      > div.body {
        div, p {  }
        div.mediaobject {

         #content>#image>.style(any; book-end; solution);
        }
        #content>#solution>#body>.style(@kind; book-end);
      }
      div.table table caption { #content>#table>#caption>.style(any; book-end; solution); }
    }
  }
}


/* ---------------------------------------------------
 * End of Book References
 * ---------------------------------------------------
 */
div.end-of-book-references {
  #part>#book-end>#end-of-book-references>.style();

  > .title {
    #part>#book-end>#end-of-book-references>#title>.style();
  }

  // As with .chapter-area in solutions above, we will have to
  // decide on what type of slot we wish to create.
  > .chapter-area {
    > .title {
      #part>#book-end>#end-of-book-references>#chapter-area>.style();
    }

    > .body > .section-area > .title { #part>#book-end>#end-of-book-references>#section-area>#title>.style(); }
    > .body > .section-area > .body p { #part>#book-end>#end-of-book-references>#reference>.style(); }

    > .body > p {

      > a.link {

      }
    }
  }
}


/* ---------------------------------------------------
 * Index
 * ---------------------------------------------------
 */
.index {
  #part>#book-end>#index>.style();

  > .title {
    #part>#book-end>#index>#title>.style();
  }

  // This is required to override ccap base without targetting both .title and .title h2.
  // The goal here is to make > .title h2 go away.
  > .title h2 {

  }

  h3.letter {
    #part>#book-end>#index>.letter();
  }
  h3.letter:first-of-type {

  }

  .index-term {
    #part>#book-end>#index>.term();
  }

  a {
    #part>#book-end>#index>.link();
  }
}

/********************************************************************
 * Generic Elements
 ********************************************************************/

h5 {
  #content>#heading>.style(h5);
}
h6 {
  #content>#heading>.style(h6);
}

// Parent level link style
a { #content>#link>.style(); }

body {
  #content>#body>.style(any);
}
.book > .cnx-title h1 {
  #part>#titlepage>#title>.style();
}
img { #content>#image>.style(any; any); }
p { #content>#paragraph>.style(any); }
img, figure, subfigure  { margin: 1em; }



/* ---------------------------------------------------
 * End of book Attributions and About Connexions
 * ---------------------------------------------------
 */
.colophon > h1.title {
  #part>#book-end>#colophon>.style();
}
.colophon p:first-of-type {
  margin-top: 0;
  padding-top: 0;
}

/******************************************************************************
 * Breakout of figure code into 3 sizes (large, medium, small) for left aligned figure text
 ******************************************************************************/



/* ---------------------------------------------------
 * Figures/Subfigures
 * ---------------------------------------------------
 */

// Updated points width for PreCalculus assets @150 dpi
@figure-width-medium: 351pt;  // Width of 3/4 size art
@figure-width-small:  234pt;  // Width of 1/2 size art

.figure {
  #content>#figure>.style();

  // size the surrounding container to the size of the image container to allow the
  // left justified alignment of the Figure numbering and associated caption
  // default width is (hero) full size @ 625px. Specifying no class or width defaults
  // to full size.

  // 3/4 size art
  &.medium {
    width: @figure-width-medium;
  }

  // 1/2 size art
  &.small {
    width: @figure-width-small;
  }

  > .body {
    #content>#figure>#body>.style(any; any);
  }

  > .title {
    #content>#figure>#title>.number(); // "Figure x.x..."
  }

  > .caption {
    #content>#figure>#title>.style();
  }

  & img {
    #content>#image>.style(@kind; @part; figure);
  }

}

/******************************************************************************
 * Addition of .commentary selector styling for Analysis header in examples
 ******************************************************************************/
.example .exercise {
  .commentary > .title {
    #content>#commentary>#title>.style(@kind; @part; exercise; example);

  }
}


/* -------------------------
 * End of Section Exercise Styling
 * -------------------------
 */

// Headers are san-serif but the text of exercises are serif
.section .exercise {
  #content>#exercise>.style(@kind; @part; section);
}

.section.section-exercises {
  // here section-exercises is @kind, not @context.
  #content>#section>.style(section-exercises; @part);

  // Create Exercises Title above sections
  &::before {
    #content>#section>#title>.style(section-exercises; @part);
  }
  // turn off "Section Exercises" title
  > .titlepage {
    display: none;
  }
  .exercise {
    #content>#exercise>.style(@kind; @part; section-exercise);
  }

  .exercise > .title {
    #content>#exercise>#title>.style(@kind; @part; section-exercise);
  }

  .exercise .problem .figure { #content>#figure>.style(@kind; @part; problem; exercise; section-exercise); }

  // The end-of-section exercises should not display solutions
  // It will be either this if they wish to do a solutions manual, or we will
  // collate to end-of-book
  .exercise .solution { #content>#solution>.style(@kind; @part; exercise; section-exercise); }

  // turn off default display for exercises that displays "Exercise x.x"
  .exercise:not(.labeled) > .title > span:first-child:not(.labeled):before {
    display: none;
  }
}

/********************************************************************
 * Glossary
 ********************************************************************/
.glossary {
  #content>#glossary>.style();

  .title {
    #content>#glossary#title>.style();
  }

  // Remove ":"
  dl dt::after { #content>#glossary>.divider(); }

  // Remove terms indentation
  dl { #content>#glossary>.dl(); }
}



/* -------------------------
 * Example Elements Styling and Numbering
 * -------------------------
 */
.chapter .example { #content>#example>.style(any); }
.example > .title {
  #content>#example>#title>.style(any);
}
.example > .title > * {

}
.example > .body { #content>#example>#body>.style(any); }

.example .solution { #content>#solution>.style(any; any; example); }

// This lengthy selector is required to override a display:none.
div.book div.chapter > div.section div.example div.exercise .solution {
  .table > table > caption::before {
    #content>#table>#caption>.style(any; any; solution; exercise; example);
  }
  .table { #content>#table>.style(any; any; solution; exercise; example); }

  .figure {
    #content>#figure>.style(any; any; solution; exercise; example);

  .body {

    }
  }

  .figure .title span.cnx-gentext-t::before {
    #content>#figure>#title>.number(any; any; solution; exercise; example);
  }
}
div.book div.chapter > div.section div.example div.exercise .problem {
  .table > table > caption::before {
    #content>#table>#caption>.style(any; any; problem; exercise; example);
  }
  .table {
    #content>#table>.style(any; any; problem; exercise; example);
  }
  .figure {
    #content>#figure>.style(any; any; problem; exercise; example);

    .body {

    }
  }
  .figure .title span.cnx-gentext-t::before {
    #content>#figure>#title>.number(any; any; problem; exercise; example);
  }
}
div.book div.chapter > div.section div.example div.exercise .commentary {
   .table > table > caption::before {
    #content>#table>#caption>.style(any; any; commentary; exercise; example);
  }
  .table {
    #content>#table>.style(any; any; commentary; exercise; example);
  }
  .figure {
    #content>#figure>.style(any; any; commentary; exercise; example);

    .body {

    }
  }
  .figure .title span.cnx-gentext-t::before {
    #content>#figure>#title>.number(any; any; commentary; exercise; example);
  }
}
// for examples that have a problem/solution structure that need numbered headings
.example .exercise {
  #content>#exercise>.style(any; any; example);

  .problem > .title {
    #content>#problem>#title>.style(any; any; exercise; example);
  }

  .solution > .title {
    #content>#solution>#title>.style(any; any; exercise; example);
  }

  .solution > .body {
    #content>#solution>#body>.style(any; any; exercise; example);
  }
  .solution > .body > a.target-figure {

  }
  .solution > .body > p:first-of-type {

  }
  .solution > .title > p {

  }
  .solution {
    ol,ul {
      #content>#list>.style(any; any; solution; exercise; example);
    }
  }
}

/******************************************************************************
 * Tables
 ******************************************************************************/

  table {
    #content>#table>.style(any; any);

    caption {
      #content>#table>#caption>.style(any; any);
    }

    thead { #content>#table>#head>.style(any; any); }
    tbody { #content>#table>#body>.style(any; any); }
    tr { #content>#table>#row>.style(any; any); }
    th { #content>#table>#header>.style(any; any); }
    td { #content>#table>#data>.style(any; any); }
    // Add styling for table entries that should render as table headers
    td.header { #content>#table>#data>.style('header'; any); }

  }

  //handle lists inside tables
ul.itemizedlist, ol.orderedlist {
    #content>#list>.style(any; any; table);
    > .listitem > p {
      #content>#paragraph>.style(any; any; list; table);
     }
  }

  // Special colored table...
  &.color {
    th { #content>#table>#header>.style(colored; any); }
    tr { #content>#table>#row>.style(colored; any); }
  }

}



/* ---------------------------------------------------
 * Custom Equation (Non) Numbering
 * ---------------------------------------------------
 */

// To be able for us to have some equations numbered and some non-numbered, we have to use
// a special class: <equation class="non-numbered">  This structure below is legacy and used
// throughout all book from inception. Instead of turning all numbering off as in other books
// We simply use new non-numbered class here to turn off only those that manually need to.
// since .equation .label is being set as well and hidden (we have to address using this)
// instead of *:last-child::after (yikes).  For those that do display as numbered, need
// to be @orange and bold.
div.book,
div.book > div.part {
  > div.preface,
  > div.chapter,
  > div.appendix {

    /*
    > div.section div.equation.non-numbered > *:last-child::after {
      display: none;
    }
    */

    > div.section div.equation > *:last-child::after {
    }
    }
  }
}


/* -------------------------
 * Lists
 * -------------------------
 */
div.itemizedlist, div.orderedlist {
  ul, ol {
    #content>#list>.style(any; any);
  }
}


/********************************************************************
 * SVG Color cascading.
 ********************************************************************/

// !important is used to override inline styles.

svg {
  text { fill: currentColor !important; }
  line { stroke: currentColor !important; }
}